<div class="col">
    <div class="card h-100 product-card-m4 border-0">
        {% set precos = produto.calcular_precos() %}
        {# Badges #}
        {% if precos.em_oferta %}
            <span class="m4-badge" style="background: var(--m4-danger);">-15% OFF</span>
        {% elif produto.eh_lancamento %}
            <span class="m4-badge" style="background: var(--m4-gold); color: #000;">NOVO</span>
        {% endif %}
        {# Wishlist #}
        <button class="m4-wishlist-btn">
            <i class="bi bi-heart"></i>
        </button>
        {# Imagem #}
        <a href="{{ url_for('loja.detalhe_produto', slug=produto.slug) }}" class="text-decoration-none">
            <div class="m4-img-container">
                {% if produto.foto_url %}
                    <img src="{{ gerar_link(produto.foto_url) }}" alt="{{ produto.nome }}" class="m4-product-img">
                {% else %}
                    <i class="bi bi-image" style="font-size: 48px; opacity: 0.1;"></i>
                {% endif %}
            </div>
        </a>
        {# Info #}
        <div class="p-0 pt-3 text-start">
            <span class="m4-brand-label">{{ produto.marca_rel.nome if produto.marca_rel else 'M4 T√ÅTICA' }}</span>
            <h6 class="m4-product-name">
                <a href="{{ url_for('loja.detalhe_produto', slug=produto.slug) }}">
                    {{ produto.nome }}
                </a>
            </h6>
            <div class="mt-3">
                {% if precos.em_oferta %}
                    <p class="m4-old-price">{{ produto.preco_a_vista | currency }}</p>
                {% endif %}
                <p class="m4-main-price">{{ precos.preco_a_vista | currency }}</p>
                <p class="m4-installments">Ou 12x de R$ {{ (precos.preco_a_vista / 12) | round(2) }}</p>
            </div>
        </div>
        {# CTA #}
        <div class="mt-3">
            <a href="{{ url_for('loja.detalhe_produto', slug=produto.slug) }}" class="m4-btn-details">
                VER DETALHES
            </a>
        </div>
    </div>
</div>
<style>
    .product-card-m4 {
        background: transparent;
        position: relative;
        transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }
    .product-card-m4:hover {
        transform: translateY(-8px);
    }
    .m4-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        color: #fff;
        font-size: 9px;
        font-weight: 900;
        padding: 4px 10px;
        z-index: 10;
        letter-spacing: 0.5px;
    }
    .m4-wishlist-btn {
        position: absolute;
        top: 12px;
        left: 12px;
        z-index: 10;
        background: none;
        border: none;
        color: #ccc;
        font-size: 18px;
        cursor: pointer;
        transition: 0.3s;
        padding: 4px;
    }
    .m4-wishlist-btn:hover {
        color: var(--m4-danger, #d9534f);
    }
    .m4-img-container {
        background-color: var(--m4-gray-bg);
        height: 220px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        overflow: hidden;
        transition: background-color 0.3s;
    }
    .product-card-m4:hover .m4-img-container {
        background-color: #eeeeee;
    }
    .m4-product-img {
        max-height: 100%;
        max-width: 100%;
        object-fit: contain;
        mix-blend-mode: multiply;
        transition: transform 0.5s ease;
    }
    .product-card-m4:hover .m4-product-img {
        transform: scale(1.05);
    }
    .m4-brand-label {
        font-size: 9px;
        font-weight: 800;
        color: #999;
        letter-spacing: 1.2px;
        text-transform: uppercase;
    }
    .m4-product-name {
        font-size: 13px;
        font-weight: 700;
        margin-top: 6px;
        height: 38px;
        overflow: hidden;
        line-height: 1.45;
    }
    .m4-product-name a {
        color: #111;
        text-decoration: none;
        transition: 0.2s;
    }
    .m4-product-name a:hover {
        color: var(--m4-gold);
    }
    .m4-old-price {
        font-size: 11px;
        text-decoration: line-through;
        color: #bbb;
        margin: 0;
    }
    .m4-main-price {
        font-size: 19px;
        font-weight: 900;
        color: #000;
        margin: 0;
        letter-spacing: -0.5px;
    }
    .m4-installments {
        font-size: 11px;
        color: #777;
        margin: 0;
    }
    .m4-btn-details {
        display: block;
        width: 100%;
        padding: 10px;
        background: transparent;
        border: 1px solid #ddd;
        color: #333;
        font-size: 10px;
        font-weight: 800;
        text-align: center;
        text-decoration: none;
        letter-spacing: 1px;
        text-transform: uppercase;
        transition: 0.3s;
    }
    .product-card-m4:hover .m4-btn-details {
        background-color: #000;
        color: #fff;
        border-color: #000;
    }
    @media (max-width: 576px) {
        .m4-img-container { height: 180px; padding: 16px; }
        .m4-main-price { font-size: 16px; }
        .m4-product-name { font-size: 12px; height: 34px; }
    }
</style>