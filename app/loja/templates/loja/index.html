{% extends 'loja/base.html' %}
{% block content %}
{# =============================================
   HOMEPAGE — HERO + CATEGORIAS + PRATELEIRAS
   ============================================= #}
{% if not termo_busca and not categoria_ativa and pagination.page == 1 %}
<!-- HERO CAROUSEL -->
<div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="6000">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active" style="height: 75vh; min-height: 400px;">
            <a href="{{ url_for('loja.categoria', slug_categoria='pistolas') }}">
                <img src="{{ url_for('static', filename='img/banner-loja.jpg') }}" class="d-block w-100 h-100" alt="Linha de Precisão 2026" style="object-fit: cover;">
                <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.2), transparent);"></div>
                <div class="carousel-caption text-start" style="bottom: 15%; left: 5%; right: auto; max-width: 500px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); padding: 32px; border-left: 4px solid var(--m4-gold);">
                    <h2 class="font-display fw-bold text-uppercase" style="font-size: 2.8rem; letter-spacing: 1px;">Linha de Precisão 2026</h2>
                    <p class="fs-5 opacity-75">As melhores marcas mundiais você encontra aqui em Teresina.</p>
                    <span class="btn-m4 mt-2">VER OFERTAS</span>
                </div>
            </a>
        </div>
        <div class="carousel-item" style="height: 75vh; min-height: 400px;">
            <a href="{{ url_for('loja.categoria', slug_categoria='outdoor') }}">
                <img src="{{ url_for('static', filename='img/banner-outdoor.jpg') }}" class="d-block w-100 h-100" alt="Equipamentos Operacionais" style="object-fit: cover;">
                <div style="position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.2), transparent);"></div>
                <div class="carousel-caption text-end" style="bottom: 15%; right: 5%; left: auto; max-width: 500px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); padding: 32px; border-right: 4px solid var(--m4-gold);">
                    <h2 class="font-display fw-bold text-uppercase" style="font-size: 2.8rem; letter-spacing: 1px;">Equipamentos Operacionais</h2>
                    <p class="fs-5 opacity-75">Resistência extrema para qualquer missão tática.</p>
                    <span class="btn-m4 mt-2">EXPLORAR OUTDOOR</span>
                </div>
            </a>
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>
<!-- GRID DE CATEGORIAS -->
<div class="container py-5">
    <div class="row g-4 justify-content-center text-center">
        {% set cat_icons = [
            ('Pistolas', 'bi-crosshair', 'pistolas'),
            ('Munições', 'bi-box-seam', 'municoes'),
            ('Coldres', 'bi-shield', 'acessorios'),
            ('Rifles', 'bi-bullseye', 'rifles'),
            ('Outdoor', 'bi-tree', 'outdoor'),
            ('Ofertas', 'bi-percent text-danger', 'ofertas')
        ] %}
        {% for nome, icon, slug in cat_icons %}
        <div class="col-4 col-sm-2">
            <a href="{{ url_for('loja.categoria', slug_categoria=slug) }}" class="text-decoration-none text-dark d-block category-item">
                <div class="mx-auto mb-2 d-flex align-items-center justify-content-center rounded-circle shadow-sm" style="width: 80px; height: 80px; background: var(--m4-gray-bg); transition: 0.3s;">
                    <i class="bi {{ icon }}" style="font-size: 28px;"></i>
                </div>
                <span style="font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;">{{ nome }}</span>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
<div class="container">
    {# =============================================
       HOME — PRATELEIRAS
       ============================================= #}
    {% if not termo_busca and not categoria_ativa %}
        <!-- LANÇAMENTOS -->
        {% if lancamentos %}
        <section class="mb-5">
            <div class="shelf-header">
                <h4 class="shelf-title">Lançamentos</h4>
                <a href="#" class="shelf-link">Ver Tudo</a>
            </div>
            <div class="row row-cols-2 row-cols-md-4 g-4">
                {% for produto in lancamentos %}
                    {% include 'loja/_card_produto.html' %}
                {% endfor %}
            </div>
        </section>
        {% endif %}
        <!-- BANNER PROMO DESPACHANTE -->
        <section class="mb-5">
            <div class="promo-banner">
                <h2>Despachante M4 Tática</h2>
                <p class="mb-4 mx-auto" style="max-width: 500px;">Saiba como adquirir sua arma legalmente com nossa assessoria completa.</p>
                <a href="#" class="btn-m4-outline">Saiba Mais</a>
            </div>
        </section>
        <!-- PISTOLAS E REVÓLVERES -->
        {% if prateleiras.pistolas %}
        <section class="mb-5">
            <div class="shelf-header">
                <h4 class="shelf-title">Pistolas e Revólveres</h4>
                <a href="{{ url_for('loja.categoria', slug_categoria='pistolas') }}" class="shelf-link">Ver Tudo</a>
            </div>
            <div class="row row-cols-2 row-cols-md-4 g-4">
                {% for produto in prateleiras.pistolas %}
                    {% include 'loja/_card_produto.html' %}
                {% endfor %}
            </div>
        </section>
        {% endif %}
        <!-- RIFLES E CARABINAS -->
        {% if prateleiras.rifles %}
        <section class="mb-5">
            <div class="shelf-header">
                <h4 class="shelf-title">Rifles e Carabinas</h4>
                <a href="{{ url_for('loja.categoria', slug_categoria='rifles') }}" class="shelf-link">Ver Tudo</a>
            </div>
            <div class="row row-cols-2 row-cols-md-4 g-4">
                {% for produto in prateleiras.rifles %}
                    {% include 'loja/_card_produto.html' %}
                {% endfor %}
            </div>
        </section>
        {% endif %}
        <!-- ESPINGARDAS -->
        {% if prateleiras.espingardas %}
        <section class="mb-5">
            <div class="shelf-header">
                <h4 class="shelf-title">Espingardas</h4>
                <a href="{{ url_for('loja.categoria', slug_categoria='espingardas') }}" class="shelf-link">Ver Tudo</a>
            </div>
            <div class="row row-cols-2 row-cols-md-4 g-4">
                {% for produto in prateleiras.espingardas %}
                    {% include 'loja/_card_produto.html' %}
                {% endfor %}
            </div>
        </section>
        {% endif %}
    {% endif %}
    {# =============================================
       BUSCA / CATEGORIA — GRID COM FILTROS
       ============================================= #}
    {% if termo_busca or categoria_ativa or pagination.page > 1 %}
    <div class="row">
        <!-- SIDEBAR FILTROS -->
        <aside class="col-lg-3 d-none d-lg-block">
            <div class="sidebar-loja bg-white p-4 border shadow-sm">
                <h6 class="filter-title">Filtrar por</h6>
                <div class="mb-4">
                    <small class="fw-bold d-block mb-2">Marca</small>
                    <div class="form-check small">
                        <input class="form-check-input" type="checkbox"> <label class="form-check-label">Taurus</label>
                    </div>
                    <div class="form-check small">
                        <input class="form-check-input" type="checkbox"> <label class="form-check-label">Glock</label>
                    </div>
                    <div class="form-check small">
                        <input class="form-check-input" type="checkbox"> <label class="form-check-label">CBC</label>
                    </div>
                </div>
                <div class="mb-4">
                    <small class="fw-bold d-block mb-2">Preço</small>
                    <input type="range" class="form-range" min="0" max="50000">
                </div>
            </div>
        </aside>
        <!-- GRID DE PRODUTOS -->
        <div class="col-lg-9">
            <h2 class="h5 fw-bold text-uppercase mb-4">
                {% if termo_busca %}
                    Resultado da busca: <span style="color: var(--m4-gold);">"{{ termo_busca }}"</span>
                {% elif categoria_ativa %}
                    Categoria: <span style="color: var(--m4-gold);">{{ categoria_ativa.nome }}</span>
                {% else %}
                    Catálogo de Produtos
                {% endif %}
            </h2>
            <div class="row row-cols-2 row-cols-md-3 g-4">
                {% for produto in produtos %}
                    {% include 'loja/_card_produto.html' %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    {# PAGINAÇÃO #}
    {% if pagination and pagination.pages > 1 %}
    <nav class="mt-5">
        <ul class="pagination justify-content-center">
            <li class="page-item {{ 'disabled' if not pagination.has_prev }}">
                <a class="page-link border-0 shadow-sm mx-1 text-dark" href="{{ url_for('loja.index', page=pagination.prev_num, q=termo_busca) if pagination.has_prev else '#' }}">&laquo;</a>
            </li>
            {% for num in pagination.iter_pages() %}
                {% if num %}
                <li class="page-item {{ 'active' if num == pagination.page }}">
                    <a class="page-link border-0 shadow-sm mx-1 {{ 'text-white' if num == pagination.page else 'text-dark bg-white' }}" href="{{ url_for('loja.index', page=num, q=termo_busca) }}" {% if num == pagination.page %}style="background-color: var(--m4-dark);"{% endif %}>{{ num }}</a>
                </li>
                {% endif %}
            {% endfor %}
            <li class="page-item {{ 'disabled' if not pagination.has_next }}">
                <a class="page-link border-0 shadow-sm mx-1 text-dark" href="{{ url_for('loja.index', page=pagination.next_num, q=termo_busca) if pagination.has_next else '#' }}">&raquo;</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}