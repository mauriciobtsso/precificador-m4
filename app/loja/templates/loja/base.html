<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% if request.endpoint == 'loja.index' and banners %}
    <link rel="preload" as="image" href="{{ gerar_link(banners[0].imagem_url) }}" fetchpriority="high">
    {% endif %}
    
    <title>{% block title %}{{ title if title else 'M4 Tática | Armas, Munições e Acessórios' }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ meta_desc if meta_desc else 'A maior variedade de armas e munições com a qualidade M4 Tática.' }}{% endblock %}">
    
    <meta property="og:site_name" content="M4 Tática">
    <meta property="og:type" content="website">
    {% block opengraph %}
    <meta property="og:title" content="M4 Tática | Armas e Munições">
    <meta property="og:description" content="A maior variedade de armas e munições com a qualidade M4 Tática.">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:image" content="{{ url_for('static', filename='img/logo.png', _external=True) }}">
    {% endblock %}

    <link rel="canonical" href="{{ request.url }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon-loja.png') }}" type="image/png">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon-loja.png') }}" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="{{ url_for('static', filename='vendor/googlefonts/fonts.css') }}" rel="stylesheet" media="print" onload="this.media='all'">
    
    <link href="{{ url_for('static', filename='vendor/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/all.min.css') }}">
    
    <style>
        :root {
            --m4-dark: #000000;
            --m4-gold: #c5a059;
            --m4-gold-hover: #a68546;
            --m4-gray-bg: #f8f9fa;
            --m4-text: #333333;
            --m4-border: #e5e5e5;
            /* Cor de contraste otimizada para acessibilidade sobre fundo escuro */
            --m4-gray-light: #cecece; 
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--m4-text);
            margin: 0;
            overflow-x: hidden;
        }

        header {
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 2000;
            background-color: var(--m4-dark);
        }

        .navbar-main { padding: 15px 0; border-bottom: 1px solid #222; }
        
        .navbar-brand { position: relative; z-index: 2001; display: inline-block; }
        .logo-img { height: 55px; width: auto; object-fit: contain; }
        
        .search-container { max-width: 500px; width: 100%; }
        .search-box-m4 { background: #fff; border: none; border-radius: 4px 0 0 4px !important; padding: 12px 20px; font-size: 14px; }
        .search-btn-m4 { background: var(--m4-gold); border: none; border-radius: 0 4px 4px 0 !important; padding: 0 20px; color: #000; }

        .header-icon { color: #fff; font-size: 22px; text-decoration: none; position: relative; padding: 5px 10px; transition: 0.3s; }
        .header-icon:hover { color: var(--m4-gold); }
        .cart-badge { position: absolute; top: -5px; right: -2px; background: var(--m4-gold); color: #000; font-size: 10px; font-weight: 900; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        .nav-departments { background-color: #ffffff; border-bottom: 3px solid var(--m4-gold); }
        .nav-departments .nav-link { 
            color: #111 !important; 
            font-size: 12px; 
            font-weight: 800; 
            text-transform: uppercase; 
            padding: 16px 15px !important; 
            letter-spacing: 1px;
            transition: 0.3s;
        }
        
        @media (min-width: 992px) {
            .dropdown:hover > .dropdown-menu { display: block; margin-top: 0; }
            .nav-departments .nav-link:hover { color: var(--m4-gold) !important; background: #fdfdfd; }
        }

        .dropdown-menu { 
            border-radius: 0; 
            border: none; 
            border-top: 3px solid var(--m4-gold); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            min-width: 250px; 
            padding: 10px 0;
            max-height: 80vh; 
            overflow-y: auto; 
        }
        
        .dropdown-menu::-webkit-scrollbar { width: 5px; }
        .dropdown-menu::-webkit-scrollbar-track { background: #f1f1f1; }
        .dropdown-menu::-webkit-scrollbar-thumb { background: var(--m4-gold); }

        .dropdown-item { font-size: 13px; font-weight: 600; padding: 10px 25px; transition: 0.2s; }
        .dropdown-item:hover { background-color: var(--m4-gray-bg); color: var(--m4-gold); padding-left: 30px; }

        footer { background-color: #111; color: #fff; padding: 60px 0 20px; margin-top: 80px; }
        footer h6 { color: #fff; font-weight: 800; text-transform: uppercase; font-size: 14px; margin-bottom: 25px; letter-spacing: 1px; border-left: 3px solid var(--m4-gold); padding-left: 10px; }
        
        /* Ajuste de contraste: cinza mais claro para passar no Lighthouse */
        footer a { color: var(--m4-gray-light); text-decoration: none; transition: 0.3s; font-size: 13px; }
        footer a:hover { color: var(--m4-gold); padding-left: 5px; }
        
        .footer-info-text { color: var(--m4-gray-light) !important; font-size: 13px; }

        .copyright-text { 
            font-size: 11px; 
            color: #ffffff !important; 
            opacity: 0.8;
            letter-spacing: 0.5px;
            line-height: 1.6;
        }

        @media (max-width: 991px) {
            .search-container { order: 3; max-width: 100%; margin-top: 15px; }
            .logo-img { height: 40px; }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <header>
        <div class="navbar-main">
            <div class="container d-flex flex-wrap align-items-center justify-content-between">
                <a href="{{ url_for('loja.index') }}" class="navbar-brand m-0" aria-label="M4 Tática - Página Inicial">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo M4 Tática" class="logo-img">
                </a>

                <div class="search-container d-flex">
                    <form action="{{ url_for('loja.index') }}" method="GET" class="d-flex w-100 shadow-sm" role="search">
                        <input type="text" name="q" class="form-control search-box-m4" placeholder="O que você está procurando?" value="{{ termo_busca or '' }}" aria-label="Buscar produtos">
                        <button type="submit" class="search-btn-m4" aria-label="Pesquisar"><i class="bi bi-search"></i></button>                    
                    </form>
                </div>

                <div class="d-flex align-items-center gap-2">
                    <a href="#" class="header-icon" aria-label="Minha Conta"><i class="bi bi-person-circle"></i></a>
                    <a href="#" class="header-icon" aria-label="Meu Carrinho">
                        <i class="bi bi-cart3"></i>
                        <span class="cart-badge">0</span>
                    </a>
                </div>
            </div>
        </div>

        <nav class="nav-departments d-none d-lg-block" aria-label="Navegação por categorias">
            <div class="container">
                <ul class="nav justify-content-center">
                    {% for cat in categorias_menu %}
                        {% if cat.exibir_no_menu %}
                            {% set subcategorias_ativas = cat.subcategorias|selectattr("exibir_no_menu", "equalto", True)|list %}
                            
                            {% if subcategorias_ativas %}
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}" id="navbarDropdown{{ cat.id }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        {{ cat.nome }}
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown{{ cat.id }}">
                                        <li><a class="dropdown-item fw-bold text-dark border-bottom mb-1" href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">VER TUDO EM {{ cat.nome|upper }}</a></li>
                                        {% for sub in subcategorias_ativas %}
                                            <li><a class="dropdown-item" href="{{ url_for('loja.categoria', slug_categoria=sub.slug) }}">{{ sub.nome }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            {% else %}
                                <li class="nav-item">
                                    <a class="nav-link" href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">{{ cat.nome }}</a>
                                </li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    <li class="nav-item">
                        <a class="nav-link text-danger fw-bold" href="https://wa.me/{{ loja.loja_whatsapp if loja.loja_whatsapp else '558630255885' }}" target="_blank" rel="noopener">
                            <i class="bi bi-shield-check me-1"></i> SERVIÇOS / CR
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main id="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <h6>Conteúdo</h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('loja.fale_conosco') }}">Fale Conosco</a></li>
                        {% for p in paginas_rodape %}
                        <li><a href="{{ url_for('loja.exibir_pagina', slug=p.slug) }}">{{ p.titulo }}</a></li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Categorias Principais</h6>
                    <ul class="list-unstyled">
                        {% for cat in categorias_menu[:6] %}
                            {% if cat.exibir_no_menu %}
                                <li><a href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">{{ cat.nome }}</a></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Informações da Loja</h6>
                    <p class="mb-1 fw-bold text-white">{{ loja.loja_nome_fantasia if loja.loja_nome_fantasia else 'M4 Tática' }}</p>
                    <p class="mb-1 footer-info-text">CNPJ: {{ loja.loja_cnpj if loja.loja_cnpj else '41.654.218/0001-47' }}</p>
                    
                    <p class="mb-1">
                        <a href="https://wa.me/{{ loja.loja_whatsapp if loja.loja_whatsapp else '558630255885' }}" target="_blank" class="text-decoration-none" rel="noopener">
                            <i class="bi bi-whatsapp text-success" aria-hidden="true"></i> <span class="footer-info-text">{{ loja.loja_telefone if loja.loja_telefone else '(86) 3025-5885' }}</span>
                        </a>
                    </p>
                    
                    <div class="footer-social d-flex gap-3 mt-3">
                        {% if loja.loja_instagram %}
                        <a href="https://instagram.com/{{ loja.loja_instagram|replace('@', '') }}" target="_blank" class="fs-4 text-white" aria-label="Siga-nos no Instagram" rel="noopener">
                            <i class="bi bi-instagram"></i>
                        </a>
                        {% endif %}
                        <a href="mailto:{{ loja.loja_email }}" class="fs-4 text-white" aria-label="Envie-nos um e-mail"><i class="bi bi-envelope"></i></a>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Pagamento & Segurança</h6>
                    <div class="payment-icons mb-3">
                        <img src="https://img.icons8.com/color/38/visa.png" alt="Visa" loading="lazy" width="38" height="38">
                        <img src="https://img.icons8.com/color/38/mastercard.png" alt="Mastercard" loading="lazy" width="38" height="38">
                        <img src="https://img.icons8.com/color/38/pix.png" alt="Pix" loading="lazy" width="38" height="38">
                    </div>
                    <div class="d-flex gap-2">
                        <i class="bi bi-shield-check fs-2 text-success" title="Site Seguro" aria-hidden="true"></i>
                        <i class="bi bi-lock fs-2 text-white-50" title="SSL Ativo" aria-hidden="true"></i>
                    </div>
                </div>
            </div>

            <div class="footer-bottom mt-5 pt-4 border-top border-secondary text-center">
                <p class="copyright-text">© 2026 {{ loja.loja_nome_fantasia|upper if loja.loja_nome_fantasia else 'M4 TÁTICA' }}. TODOS OS DIREITOS RESERVADOS. <br>
                Venda de armas e munições de acordo com a legislação vigente.</p>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='vendor/bootstrap/bootstrap.bundle.min.js') }}" defer></script>
    {% block extra_js %}{% endblock %}
</body>
</html>