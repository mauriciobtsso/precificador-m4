<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{% block title %}{{ title if title else 'M4 Tática - Loja Oficial' }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}{{ meta_desc if meta_desc else 'A maior variedade de armas e munições com a qualidade M4 Tática.' }}{% endblock %}">
    <link rel="canonical" href="{{ request.url }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --m4-dark: #000000;
            --m4-gold: #c5a059;
            --m4-gold-hover: #a68546;
            --m4-gray-bg: #f8f9fa;
            --m4-text: #333333;
            --m4-border: #e5e5e5;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--m4-text);
            margin: 0;
            overflow-x: hidden;
        }

        /* HEADER FIXO */
        header {
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 2000;
            background-color: var(--m4-dark);
        }

        /* NAVBAR PRINCIPAL */
        .navbar-main { padding: 15px 0; border-bottom: 1px solid #222; }
        .logo-img { height: 55px; width: auto; object-fit: contain; }
        
        .search-container { max-width: 500px; width: 100%; }
        .search-box-m4 { background: #fff; border: none; border-radius: 4px 0 0 4px !important; padding: 12px 20px; font-size: 14px; }
        .search-btn-m4 { background: var(--m4-gold); border: none; border-radius: 0 4px 4px 0 !important; padding: 0 20px; color: #000; }

        .header-icon { color: #fff; font-size: 22px; text-decoration: none; position: relative; padding: 5px 10px; transition: 0.3s; }
        .header-icon:hover { color: var(--m4-gold); }
        .cart-badge { position: absolute; top: -5px; right: -2px; background: var(--m4-gold); color: #000; font-size: 10px; font-weight: 900; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* MENU DE CATEGORIAS DINÂMICO */
        .nav-departments { background-color: #ffffff; border-bottom: 3px solid var(--m4-gold); }
        .nav-departments .nav-link { 
            color: #111 !important; 
            font-size: 12px; 
            font-weight: 800; 
            text-transform: uppercase; 
            padding: 16px 15px !important; 
            letter-spacing: 1px;
            transition: 0.3s;
        }
        
        @media (min-width: 992px) {
            .dropdown:hover > .dropdown-menu { display: block; margin-top: 0; }
            .nav-departments .nav-link:hover { color: var(--m4-gold) !important; background: #fdfdfd; }
        }

        .dropdown-menu { border-radius: 0; border: none; border-top: 3px solid var(--m4-gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); min-width: 220px; }
        .dropdown-item { font-size: 13px; font-weight: 600; padding: 10px 20px; }
        .dropdown-item:hover { background-color: var(--m4-gray-bg); color: var(--m4-gold); }

        /* CARROSSEL */
        .carousel-item img { height: 500px; object-fit: cover; width: 100%; }

        /* BANNER PROMO */
        .promo-banner { 
            background: linear-gradient(90deg, #000 0%, #1a1a1a 100%); 
            color: #fff; 
            padding: 60px 40px; 
            text-align: center; 
            border-radius: 4px;
            background-size: cover;
            background-position: center;
        }

        /* FOOTER */
        footer { background-color: #111; color: #fff; padding: 60px 0 20px; margin-top: 80px; }
        footer h6 { color: #fff; font-weight: 800; text-transform: uppercase; font-size: 14px; margin-bottom: 25px; letter-spacing: 1px; border-left: 3px solid var(--m4-gold); padding-left: 10px; }
        footer a { color: #999; text-decoration: none; transition: 0.3s; font-size: 13px; }
        footer a:hover { color: var(--m4-gold); padding-left: 5px; }

        @media (max-width: 991px) {
            .carousel-item img { height: 250px; }
            .search-container { order: 3; max-width: 100%; margin-top: 15px; }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <header>
        <div class="navbar-main">
            <div class="container d-flex flex-wrap align-items-center justify-content-between">
                <a href="{{ url_for('loja.index') }}" class="navbar-brand m-0">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="M4 Tática" class="logo-img">
                </a>

                <div class="search-container d-flex">
                    <form action="{{ url_for('loja.index') }}" method="GET" class="d-flex w-100 shadow-sm">
                        <input type="text" name="q" class="form-control search-box-m4" placeholder="O que você está procurando?" value="{{ termo_busca or '' }}">
                        <button type="submit" class="search-btn-m4"><i class="bi bi-search"></i></button>
                    </form>
                </div>

                <div class="d-flex align-items-center gap-2">
                    <a href="#" class="header-icon"><i class="bi bi-person-circle"></i></a>
                    <a href="#" class="header-icon">
                        <i class="bi bi-cart3"></i>
                        <span class="cart-badge">0</span>
                    </a>
                </div>
            </div>
        </div>

<nav class="nav-departments d-none d-lg-block">
    <div class="container">
        <ul class="nav justify-content-center">
            
            {# 1. ITEM FIXO: ARMAS DE FOGO (Agrupando subcategorias) #}
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#">Armas de Fogo</a>
                <ul class="dropdown-menu">
                    {# Aqui buscamos as subcategorias que pertencem ao grupo de Armas #}
                    {% for cat in categorias_menu %}
                        {% if "arma" in cat.nome.lower() or "pistola" in cat.nome.lower() or "rifle" in cat.nome.lower() %}
                            <li><a class="dropdown-item" href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">{{ cat.nome }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </li>

            {# 2. ITENS DINÂMICOS: O RESTANTE DAS CATEGORIAS (Limitado para não quebrar) #}
            {% for cat in categorias_menu %}
                {# Filtramos para não repetir as armas que já estão no dropdown acima #}
                {% if "arma" not in cat.nome.lower() and "pistola" not in cat.nome.lower() and "rifle" not in cat.nome.lower() %}
                    {# Limitamos a exibição no menu principal para as 6 mais importantes #}
                    {% if loop.index < 8 %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">
                            {{ cat.nome }}
                        </a>
                    </li>
                    {% endif %}
                {% endif %}
            {% endfor %}

            <li class="nav-item">
                <a class="nav-link text-danger fw-bold" href="#">Serviços / CR</a>
            </li>
        </ul>
    </div>
</nav>
    </header>

    <main>{% block content %}{% endblock %}</main>

    <footer>
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <h6>Conteúdo</h6>
                    <ul class="list-unstyled">
                        <li><a href="{{ url_for('loja.fale_conosco') }}">Fale Conosco</a></li>
                        {% for p in paginas_rodape %}
                        <li><a href="{{ url_for('loja.exibir_pagina', slug=p.slug) }}">{{ p.titulo }}</a></li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Categorias Principais</h6>
                    <ul class="list-unstyled">
                        {% for cat in categorias_menu[:6] %}
                        <li><a href="{{ url_for('loja.categoria', slug_categoria=cat.slug) }}">{{ cat.nome }}</a></li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Informações da Loja</h6>
                    <p class="mb-1"><strong>{{ loja.loja_nome_fantasia if loja.loja_nome_fantasia else 'M4 Tática' }}</strong></p>
                    <p class="mb-1 small text-muted">CNPJ: {{ loja.loja_cnpj if loja.loja_cnpj else '00.000.000/0001-00' }}</p>
                    
                    <p class="mb-1">
                        <a href="https://wa.me/{{ loja.loja_whatsapp }}" target="_blank" class="text-decoration-none">
                            <i class="bi bi-whatsapp text-success"></i> {{ loja.loja_telefone if loja.loja_telefone else '(86) 3025-5885' }}
                        </a>
                    </p>
                    
                    <div class="footer-social d-flex gap-3 mt-3">
                        {% if loja.loja_instagram %}
                        <a href="https://instagram.com/{{ loja.loja_instagram|replace('@', '') }}" target="_blank" class="fs-4 text-white">
                            <i class="bi bi-instagram"></i>
                        </a>
                        {% endif %}
                        <a href="mailto:{{ loja.loja_email }}" class="fs-4 text-white"><i class="bi bi-envelope"></i></a>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <h6>Pagamento & Segurança</h6>
                    <div class="payment-icons mb-3">
                        <img src="https://img.icons8.com/color/38/visa.png" alt="Visa">
                        <img src="https://img.icons8.com/color/38/mastercard.png" alt="Mastercard">
                        <img src="https://img.icons8.com/color/38/pix.png" alt="Pix">
                    </div>
                    <div class="d-flex gap-2">
                        <i class="bi bi-shield-check fs-2 text-success" title="Site Seguro"></i>
                        <i class="bi bi-lock fs-2 text-white-50" title="SSL Ativo"></i>
                    </div>
                </div>
            </div>

            <div class="footer-bottom mt-5 pt-4 border-top border-secondary text-center">
                <p class="small text-muted">© 2026 {{ loja.loja_nome_fantasia|upper if loja.loja_nome_fantasia else 'M4 TÁTICA' }}. TODOS OS DIREITOS RESERVADOS. <br>
                Venda de armas e munições exclusiva para maiores de 25 anos com documentação legal e CR ativo.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>