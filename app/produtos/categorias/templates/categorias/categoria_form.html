{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold text-dark mb-0">
    <i class="fas {{ 'fa-edit text-primary' if categoria else 'fa-plus-circle text-success' }} me-2"></i>
    {{ 'Editar Categoria' if categoria else 'Nova Categoria' }}
  </h2>
  <a href="{{ url_for('categorias.index') }}" class="btn btn-outline-secondary border-0 fw-bold">
    <i class="fas fa-arrow-left me-1"></i> Voltar para Listagem
  </a>
</div>

<form method="POST">
  <div class="row">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3 border-0">
          <h5 class="mb-0 fw-bold small text-uppercase text-muted">Informações da Categoria</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
<div class="col-md-12">
  <label class="form-label fw-bold small">NOME DA CATEGORIA</label>
  <input type="text" name="nome" class="form-control form-control-lg border-0 bg-light shadow-sm" 
         placeholder="Ex: Armas Curtas, Cutelaria, etc."
         value="{{ categoria.nome if categoria else '' }}" required>
</div>

<div class="col-md-12 mt-3">
  <label class="form-label fw-bold small text-primary">URL AMIGÁVEL (SLUG)</label>
  <div class="input-group shadow-sm">
    <span class="input-group-text bg-white border-0 small text-muted">/categoria/</span>
    <input type="text" name="slug" class="form-control border-0 bg-light" 
           placeholder="ex: municao-12ga"
           value="{{ categoria.slug if categoria else '' }}">
  </div>
  <div class="form-text small">
    <strong>Dica tática:</strong> Use apenas letras, números e hífens. Se deixar vazio, o sistema gera automaticamente.
  </div>
</div>
            <div class="col-md-12">
              <label class="form-label fw-bold small text-muted">HIERARQUIA (CATEGORIA PAI)</label>
              <select name="pai_id" class="form-select border-0 bg-light shadow-sm">
                <option value="">— Nenhuma (Esta é uma Categoria Principal) —</option>
                {% for cat in categorias_pai %}
                  {% if not categoria or cat.id != categoria.id %}
                    <option value="{{ cat.id }}"
                      {% if categoria and categoria.pai_id == cat.id %}selected{% endif %}>
                      {{ cat.nome }}
                    </option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>

            <div class="col-12">
              <label class="form-label fw-bold small text-muted">DESCRIÇÃO COMERCIAL (PARA O SITE)</label>
              <textarea name="descricao" class="form-control border-0 bg-light shadow-sm" rows="4" 
                        placeholder="Descreva brevemente o que o cliente encontrará nesta categoria...">{{ categoria.descricao if categoria else '' }}</textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3 border-0 text-center">
          <h5 class="mb-0 fw-bold small text-uppercase text-muted">Exibição na Vitrine</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 mb-3">
              <div class="form-check form-switch p-3 border rounded bg-light">
                <input class="form-check-input ms-0 me-2" type="checkbox" name="exibir_no_menu" id="exibir_no_menu" 
                       {% if not categoria or categoria.exibir_no_menu %}checked{% endif %}>
                <label class="form-check-label fw-bold text-dark" for="exibir_no_menu">Exibir no Menu Superior</label>
                <div class="form-text mt-1" style="font-size: 0.7rem;">Se desativado, a categoria não aparecerá na navegação principal da loja.</div>
              </div>
            </div>

            <div class="col-12">
              <label class="form-label fw-bold small">ÍCONE (BOOTSTRAP ICONS)</label>
              <div class="input-group shadow-sm">
                <span class="input-group-text bg-white border-0">
                  <i class="bi {{ categoria.icone_loja if categoria and categoria.icone_loja else 'bi-tag' }} fs-5"></i>
                </span>
                <input type="text" name="icone_loja" class="form-control border-0" 
                       placeholder="Ex: bi-shield-lock"
                       value="{{ categoria.icone_loja if categoria and categoria.icone_loja else '' }}">
              </div>
              <div class="form-text small" style="font-size: 0.75rem;">
                Use nomes de <a href="https://icons.getbootstrap.com/" target="_blank">icons.getbootstrap.com</a>
              </div>
            </div>

            <div class="col-12">
              <label class="form-label fw-bold small text-muted">ORDEM DE PRIORIDADE</label>
              <input type="number" name="ordem_exibicao" class="form-control border-0 bg-light shadow-sm" 
                     value="{{ categoria.ordem_exibicao if categoria else 0 }}">
              <div class="form-text small">Números menores aparecem primeiro no menu.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-dark btn-lg shadow fw-bold">
          <i class="fas fa-save me-1"></i> SALVAR CATEGORIA
        </button>
        
        {% if categoria %}
          <a href="{{ url_for('categorias.excluir_categoria', id=categoria.id) }}"
             onclick="return confirm('Deseja realmente excluir esta categoria? Os produtos perderão este vínculo.');"
             class="btn btn-outline-danger btn-sm border-0 mt-2">
            <i class="fas fa-trash-alt me-1"></i> Excluir Categoria permanentemente
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</form>
{% endblock %}