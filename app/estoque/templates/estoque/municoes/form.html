{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4><i class="fas fa-bullseye me-2 text-primary"></i>Nova Munição</h4>
    <a href="{{ url_for('estoque.municoes_listar') }}" class="btn btn-secondary">Voltar</a>
  </div>

  <form method="POST">
    <div class="m4-card mb-4">
      <h5><i class="fas fa-tags me-2"></i>Produto e Fornecedor</h5>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Produto</label>
          <select name="produto_id" class="form-select" required>
            <option value="">Selecione...</option>
            {% for p in produtos %}
              <option value="{{ p.id }}">{{ p.nome }} ({{ p.codigo }})</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Fornecedor</label>
          <select name="fornecedor_id" class="form-select">
            <option value="">Selecione...</option>
            {% for f in fornecedores %}
              <option value="{{ f.id }}">{{ f.nome }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>

    <div class="m4-card mb-4">
      <h5><i class="fas fa-box-open me-2"></i>Identificação e Controle</h5>
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Lote</label>
          <input type="text" name="lote" class="form-control" placeholder="Ex.: 0385 FAG72">
        </div>
        <div class="col-md-3">
          <label class="form-label">Nº Embalagem</label>
          <input type="text" name="numero_embalagem" class="form-control" placeholder="Ex.: 119516804">
        </div>
        <div class="col-md-3">
          <label class="form-label">Quantidade</label>
          <input type="number" name="quantidade" class="form-control" min="1" value="1">
        </div>
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select name="status" class="form-select">
            <option value="disponivel">Disponível</option>
            <option value="reservada">Reservada</option>
            <option value="vendida">Vendida</option>
          </select>
        </div>
        <div class="col-12">
          <label class="form-label">Observações</label>
          <textarea name="observacoes" rows="3" class="form-control"></textarea>
        </div>
      </div>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-success"><i class="fas fa-save me-1"></i> Salvar</button>
    </div>
  </form>
</div>
{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const selectProduto = document.querySelector("select[name='produto_id']");
  if (!selectProduto) return;

  fetch("/estoque/api/produtos/municao")
    .then(res => res.json())
    .then(data => {
      selectProduto.innerHTML = '<option value="">Selecione...</option>';
      data.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = `${p.nome} (${p.codigo || "sem código"})`;
        selectProduto.appendChild(opt);
      });
    })
    .catch(err => console.error("Erro ao carregar produtos:", err));
});
</script>
{% endblock %}

{% endblock %}
