{% extends "base.html" %}
{% block content %}
<div class="container py-4" style="max-width: 800px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold mb-0">
            <i class="fas fa-bullseye me-2 text-primary"></i>
            {{ 'Editar Munição' if item else 'Nova Entrada de Munição' }}
        </h4>
        <a href="{{ url_for('estoque.municoes_listar') }}" class="btn btn-outline-secondary">Voltar</a>
    </div>
    
    <form method="POST" class="needs-validation" novalidate>
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label fw-bold">Produto</label>
                        <select name="produto_id" class="form-select select2" required>
                            <option value="">Selecione...</option>
                            {% for p in produtos %}
                            <option value="{{ p.id }}" {% if item and item.produto_id == p.id %}selected{% endif %}>
                                {{ p.nome }} ({{ p.codigo or 'S/C' }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Lote</label>
                        <input type="text" name="lote" class="form-control" value="{{ item.lote if item else '' }}">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Nº Embalagem (Opcional)</label>
                        <input type="text" name="numero_embalagem" class="form-control" value="{{ item.numero_embalagem if item else '' }}" placeholder="Ex: CX-01">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Quantidade (Unidades)</label>
                        <input type="number" name="quantidade" class="form-control" value="{{ item.quantidade if item else 1 }}" min="1" required>
                        <div class="form-text">Total de munições neste lote/caixa.</div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Data Entrada</label>
                        <input type="date" name="data_entrada" class="form-control" value="{{ item.data_entrada if item else hoje }}">
                    </div>

                    <div class="col-md-12">
                        <label class="form-label">Fornecedor</label>
                        <select name="fornecedor_id" class="form-select select2">
                            <option value="">Selecione...</option>
                            {% for f in fornecedores %}
                            <option value="{{ f.id }}" {% if item and item.fornecedor_id == f.id %}selected{% endif %}>
                                {{ f.nome }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="col-12">
                        <label class="form-label">Observações</label>
                        <textarea name="observacoes" class="form-control" rows="2">{{ item.observacoes if item else '' }}</textarea>
                    </div>

                    <div class="col-12 mt-4 text-end">
                        <button type="submit" class="btn btn-success px-5">
                            <i class="fas fa-save me-2"></i> Salvar Dados
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    if (typeof $ !== 'undefined' && $.fn.select2) {
        $('.select2').select2({ theme: 'bootstrap-5', width: '100%' });
    }
});
</script>
{% endblock %}
{% endblock %}