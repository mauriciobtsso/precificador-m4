{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-credit-card"></i> Simulação de Parcelamento</h2>
    <span class="text-muted">Escolha um produto ou use a simulação rápida</span>
</div>

<div class="row">
    <!-- Seleção de Produto Cadastrado -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light fw-semibold">
                <i class="fas fa-box"></i> Produto Cadastrado
            </div>
            <div class="card-body">
                {% if produtos %}
                <form method="GET" id="formParcelamento">
                    <label for="produto_id" class="form-label">Selecione o produto</label>
                    <select name="produto_id" id="produto_id" class="form-select" required>
                        <option value="">-- Selecione --</option>
                        {% for p in produtos %}
                        <option value="{{ p.id }}">{{ p.nome }} ({{ p.sku }})</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-primary mt-3" onclick="verParcelamento()">
                        <i class="fas fa-search"></i> Ver Parcelamento
                    </button>
                </form>
                <script>
                    function verParcelamento() {
                        const produtoId = document.getElementById("produto_id").value;
                        if (produtoId) {
                            window.location.href = "{{ url_for('main.parcelamento', produto_id=0) }}".replace("0", produtoId);
                        } else {
                            alert("Selecione um produto para continuar.");
                        }
                    }
                </script>
                {% else %}
                <p class="text-muted">Nenhum produto cadastrado.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Simulação Rápida -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light fw-semibold">
                <i class="fas fa-bolt"></i> Simulação Rápida
            </div>
            <div class="card-body">
                <p>Sem precisar cadastrar o produto.</p>
                <a href="{{ url_for('main.parcelamento_rapido') }}" class="btn btn-success">
                    <i class="fas fa-play"></i> Iniciar Simulação Rápida
                </a>
            </div>
        </div>
    </div>
</div>

<!-- jQuery precisa vir ANTES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

<!-- CSS e JS do Select2 -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>

<script>
    $(function() {
        console.log("Ativando Select2...");
        if ($.fn.select2) {
            $('#produto_id').select2({
                placeholder: "Digite ou selecione o produto",
                allowClear: true,
                width: '100%'
            });
        } else {
            console.error("Select2 não carregou!");
        }
    });
</script>
{% endblock %}
