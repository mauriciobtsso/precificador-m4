{% extends "base.html" %}
{% block content %}

<!-- ===========================
     CABEÇALHO DO DASHBOARD
=========================== -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
  <h2 class="fw-semibold mb-2 text-dark">
    <i class="fas fa-chart-line text-danger me-2"></i> Painel de Controle M4
  </h2>

  <div class="d-flex align-items-center gap-2 flex-wrap">
    <div class="input-group input-group-sm" style="width: 260px; max-width: 100%;">
      <input
        type="text"
        class="form-control"
        placeholder="Buscar cliente, documento ou arma"
        aria-label="Buscar cliente, documento ou arma"
      >
      <button class="btn btn-outline-secondary" title="Buscar">
        <i class="fas fa-search"></i>
      </button>
    </div>
    <button id="toggleTheme" class="btn btn-outline-dark btn-sm" title="Alternar tema">
      <i class="fas fa-moon"></i>
    </button>
  </div>
</div>

<!-- ===========================
     SEÇÃO DE RESUMO PRINCIPAL
=========================== -->
<div id="dashboard-resumo" class="row g-3 mb-4">
  <div class="col-12 text-center text-muted py-3">
    <div class="spinner-border text-secondary me-2" role="status"></div>
    Carregando resumo...
  </div>
</div>

<!-- ===========================
     SEÇÃO DE GRÁFICOS
=========================== -->
<div class="row g-4 mb-4">
  <!-- Gráfico de Documentos -->
  <div class="col-12 col-md-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-light py-2 d-flex align-items-center justify-content-between">
        <h6 class="mb-0 fw-semibold small">
          <i class="fas fa-file-medical text-success me-2"></i> Documentos
        </h6>
      </div>
      <div class="card-body text-center py-3 d-flex justify-content-center align-items-center">
        <canvas id="chartDocs" height="120" style="max-width:200px;"></canvas>
      </div>
    </div>
  </div>

  <!-- Gráfico de Produtos -->
  <div class="col-12 col-md-8">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-light py-2 d-flex align-items-center justify-content-between">
        <h6 class="mb-0 fw-semibold small">
          <i class="fas fa-chart-pie text-danger me-2"></i> Produtos por Categoria
        </h6>
      </div>
      <div class="card-body py-3">
        <canvas id="chartArmas" height="160"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ===========================
     SEÇÃO DE ATIVIDADES RECENTES
=========================== -->
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-light py-2 d-flex align-items-center justify-content-between flex-wrap">
    <h6 class="mb-0 fw-semibold small">
      <i class="fas fa-stream text-primary me-2"></i> Atividades Recentes
    </h6>
    <button class="btn btn-sm btn-outline-secondary mt-2 mt-sm-0" id="btnAtualizarTimeline" title="Atualizar agora">
      <i class="fas fa-sync-alt fa-sm"></i>
    </button>
  </div>
  <div class="card-body py-2 small" id="dashboard-timeline"
       style="max-height: 280px; overflow-y: auto;">
    <div class="text-center text-muted py-2">
      <div class="spinner-border text-secondary me-2" role="status" style="width: 1rem; height: 1rem;"></div>
      Carregando eventos...
    </div>
  </div>
</div>

<!-- ===========================
     SEÇÃO DE ALERTAS
=========================== -->
<div class="card shadow-sm border-0 mb-5">
  <div class="card-header bg-light py-2 d-flex justify-content-between align-items-center flex-wrap">
    <h6 class="mb-0 fw-semibold small">
      <i class="fas fa-bell text-danger me-2"></i> Alertas do Sistema
    </h6>
    <button class="btn btn-sm btn-outline-secondary mt-2 mt-sm-0" id="btnAtualizarAlertas" title="Atualizar agora">
      <i class="fas fa-sync-alt fa-sm"></i>
    </button>
  </div>
  <div class="card-body py-3 small" id="dashboard-alertas">
    <div class="text-center text-muted py-2">
      <div class="spinner-border text-secondary me-2" role="status" style="width: 1rem; height: 1rem;"></div>
      Carregando alertas...
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<style>
/* ============================
   AJUSTES VISUAIS GERAIS
============================ */
@media (max-width: 768px) {
  h2.fw-semibold {
    font-size: 1.2rem;
  }

  #dashboard-resumo .card {
    margin-bottom: 0.5rem;
  }

  .card-header h6 {
    font-size: 0.9rem !important;
  }

  .card-body {
    padding: 0.75rem !important;
  }

  #chartDocs {
    max-width: 160px !important;
    height: 100px !important;
  }

  #dashboard-timeline {
    max-height: 220px !important;
  }
}

/* Scrollbar suave na timeline */
#dashboard-timeline::-webkit-scrollbar {
  width: 6px;
}
#dashboard-timeline::-webkit-scrollbar-thumb {
  background-color: #b5b5b5;
  border-radius: 4px;
}
#dashboard-timeline::-webkit-scrollbar-thumb:hover {
  background-color: #888;
}
</style>
{% endblock %}
