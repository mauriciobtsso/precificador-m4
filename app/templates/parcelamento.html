{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-credit-card"></i> Simulação de Parcelamento</h2>
  <span class="text-muted">Condições para <strong>{{ produto.nome }}</strong></span>
</div>

<!-- Resumo do produto -->
<div class="card shadow-sm mb-4">
  <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
    <div>
      <h5 class="card-title mb-1">{{ produto.nome }}</h5>
      <small class="text-muted">SKU: {{ produto.sku }}</small>
    </div>
    <span class="badge bg-primary fs-5 mt-2 mt-md-0">
      À vista: {{ (produto.preco_final or produto.preco_a_vista)|currency }}
    </span>
  </div>
</div>

<!-- Tabela de Parcelamento em Cards -->
<div class="row g-3">
  {% for r in resultado %}
  <div class="col-12 col-md-4">
    <div class="card shadow-sm h-100 text-center card-parcela">
      <div class="card-body">
        <span class="badge bg-secondary mb-2">{{ r.rotulo }}</span>
        {% if r.rotulo in ["Débito", "PIX"] %}
          <h5 class="fw-bold">{{ r.total|currency }}</h5>
          <small class="text-muted">Total: {{ r.total|currency }}</small>
        {% else %}
          <h5 class="fw-bold">{{ r.parcela|currency }}</h5>
          <small class="text-muted">Total: {{ r.total|currency }}</small>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="mt-4 text-end">
  <button id="btnCopy" class="btn btn-success">
    <i class="fas fa-copy me-1"></i> Copiar para WhatsApp
  </button>
</div>

<script>
  const textoWhats = {{ texto_whats|tojson|safe }};
  document.getElementById('btnCopy').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(textoWhats);
      alert('Texto copiado! Abra o WhatsApp e cole a mensagem.');
    } catch (e) {
      console.error(e);
      alert('Não foi possível copiar. Tente novamente.');
    }
  });
</script>
{% endblock %}
