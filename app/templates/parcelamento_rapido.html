{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-bolt"></i> Simulação Rápida</h2>
  <span class="text-muted">Calcule sem cadastrar o produto</span>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form method="POST">
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Valor à vista (R$)</label>
          <input type="number" step="0.01" class="form-control" name="preco_base" value="{{ preco_base or '' }}" required>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-calculator me-1"></i> Calcular
          </button>
        </div>
        {% if resultado %}
        <div class="col-md-5 text-end">
          <button id="btnCopy" type="button" class="btn btn-success">
            <i class="fas fa-copy me-1"></i> Copiar para WhatsApp
          </button>
        </div>
        {% endif %}
      </div>
    </form>
  </div>
</div>

{% if resultado %}
<div class="row g-3">
  <!-- PIX -->
  <div class="col-12 col-md-4">
    <div class="card shadow-sm h-100 text-center card-parcela">
      <div class="card-body">
        <span class="badge bg-success mb-2">PIX</span>
        <h5 class="fw-bold">{{ preco_base|currency }}</h5>
        <small class="text-muted">Total: {{ preco_base|currency }}</small>
      </div>
    </div>
  </div>

  <!-- Débito -->
  {% set debito_total = (preco_base or 0) / (1 - 0.0109) %}
  <div class="col-12 col-md-4">
    <div class="card shadow-sm h-100 text-center card-parcela">
      <div class="card-body">
        <span class="badge bg-info mb-2">Débito</span>
        <h5 class="fw-bold">{{ debito_total|currency }}</h5>
        <small class="text-muted">Total: {{ debito_total|currency }}</small>
      </div>
    </div>
  </div>

  <!-- Demais planos -->
  {% for r in resultado %}
  <div class="col-12 col-md-4">
    <div class="card shadow-sm h-100 text-center card-parcela">
      <div class="card-body">
        <span class="badge bg-secondary mb-2">{{ r.rotulo }}</span>
        <h5 class="fw-bold">{{ r.parcela|currency }}</h5>
        <small class="text-muted">Total: {{ r.total|currency }}</small>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<script>
  const textoWhats = {{ texto_whats|tojson|safe }};
  document.getElementById('btnCopy').addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(textoWhats);
      alert("Texto copiado! Abra o WhatsApp e cole a mensagem.");
    } catch (e) {
      console.error(e);
      alert("Não foi possível copiar. Tente novamente.");
    }
  });
</script>
{% endblock %}
